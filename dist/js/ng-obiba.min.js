/*! ng-obiba 23-05-2014 */
"use strict";angular.module("obiba.form").directive("serverError",[function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){return b.on("change",function(){return a.$apply(function(){return d.$setValidity("server",!0)})})}}}]).directive("formInput",[function(){return{restrict:"AE",require:"^form",scope:{name:"@",model:"=",label:"@",required:"@",help:"@"},templateUrl:"app/commons/form/form-input-template.html",link:function(a,b,c,d){(angular.isUndefined(a.model)||null==a.model)&&(a.model=""),a.form=d}}}]).directive("formCheckbox",[function(){return{restrict:"AE",require:"^form",scope:{name:"@",model:"=",label:"@",help:"@"},templateUrl:"app/commons/form/form-checkbox-template.html",link:function(a,b,c,d){(angular.isUndefined(a.model)||null==a.model)&&(a.model=!1),a.form=d}}}]),angular.module("obiba.form").service("FormServerValidation",["$rootScope","$log","StringUtils",function(a,b,c){this.error=function(d,e,f){if(d.data instanceof Array){var g=function(a,b){e[a].$dirty=!0,e[a].$setValidity("server",!1),null==e[a].errors&&(e[a].errors=[]),e[a].errors.push(c.capitaliseFirstLetter(b.message))};d.data.forEach(function(a){var b=a.path.split(".").slice(-2).join(".");f&&f.length?f.forEach(function(c){g(b+"-"+c,a)}):g(b,a)}),b.debug(e)}else a.$broadcast("showNotificationDialogEvent",{iconClass:"fa-exclamation-triangle",titleKey:"study.save-error",message:d.data?d.data:angular.fromJson(d)})}}]),angular.module("obiba.form",["obiba.utils","obiba.notification"]),angular.module("ngObiba",["obiba.form","obiba.notification","obiba.rest","obiba.utils"]),angular.module("obiba.notification").controller("NotificationController",["$rootScope","$scope","$modal",function(a,b,c){b.$on("showNotificationDialogEvent",function(a,b){c.open({templateUrl:"app/notification/notification-modal.html",controller:"NotificationModalController",resolve:{notification:function(){return b}}})}),b.$on("showConfirmDialogEvent",function(b,d,e){c.open({templateUrl:"app/notification/notification-confirm-modal.html",controller:"NotificationConfirmationController",resolve:{confirm:function(){return d}}}).result.then(function(){a.$broadcast("confirmDialogAcceptedEvent",e)},function(){a.$broadcast("confirmDialogRejectedEvent",e)})})}]).controller("NotificationModalController",["$scope","$modalInstance","notification",function(a,b,c){a.notification=c,a.close=function(){b.dismiss("close")}}]).controller("NotificationConfirmationController",["$scope","$modalInstance","confirm",function(a,b,c){a.confirm=c,a.ok=function(){b.close()},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("obiba.notification",["pascalprecht.translate","ui.bootstrap"]),angular.module("obiba.rest",["obiba.notification"]).config(["$httpProvider",function(a){a.responseInterceptors.push("loadingHttpInterceptor"),a.responseInterceptors.push("httpErrorsInterceptor"),a.defaults.transformRequest.push(function(a){return $("#loading").show(),a})}]).factory("loadingHttpInterceptor",["$q",function(a){return function(b){return b.then(function(a){return $("#loading").hide(),a},function(b){return $("#loading").hide(),a.reject(b)})}}]).factory("httpErrorsInterceptor",["$q","$rootScope","$log",function(a,b){return function(c){return c.then(function(a){return a},function(c){var d=c.config;return d.errorHandler?a.reject(c):(b.$broadcast("showNotificationDialogEvent",{iconClass:"fa-exclamation-triangle",titleKey:"error",message:c.data?c.data:angular.fromJson(c)}),a.reject(c))})}}]),angular.module("obiba.utils",[]).service("StringUtils",function(){this.capitaliseFirstLetter=function(a){return a.charAt(0).toUpperCase()+a.slice(1)}});