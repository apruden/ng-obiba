/*! ng-obiba 23-05-2014 */
"use strict";angular.module("obiba.form").directive("serverError",[function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){return b.on("change",function(){return a.$apply(function(){return d.$setValidity("server",!0)})})}}}]).directive("formInput",[function(){return{restrict:"AE",require:"^form",scope:{name:"@",model:"=",label:"@",required:"@",help:"@"},templateUrl:"app/commons/form/form-input-template.tpl.html",link:function(a,b,c,d){(angular.isUndefined(a.model)||null==a.model)&&(a.model=""),a.form=d}}}]).directive("formCheckbox",[function(){return{restrict:"AE",require:"^form",scope:{name:"@",model:"=",label:"@",help:"@"},templateUrl:"app/commons/form/form-checkbox-template.tpl.html",link:function(a,b,c,d){(angular.isUndefined(a.model)||null==a.model)&&(a.model=!1),a.form=d}}}]),angular.module("obiba.form").service("FormServerValidation",["$rootScope","$log","StringUtils",function(a,b,c){this.error=function(d,e,f){if(d.data instanceof Array){var g=function(a,b){e[a].$dirty=!0,e[a].$setValidity("server",!1),null==e[a].errors&&(e[a].errors=[]),e[a].errors.push(c.capitaliseFirstLetter(b.message))};d.data.forEach(function(a){var b=a.path.split(".").slice(-2).join(".");f&&f.length?f.forEach(function(c){g(b+"-"+c,a)}):g(b,a)}),b.debug(e)}else a.$broadcast("showNotificationDialogEvent",{iconClass:"fa-exclamation-triangle",titleKey:"study.save-error",message:d.data?d.data:angular.fromJson(d)})}}]),angular.module("obiba.form",["obiba.utils","obiba.notification"]),angular.module("ngObiba",["obiba.form","obiba.notification","obiba.rest","obiba.utils"]),angular.module("obiba.notification").controller("NotificationController",["$rootScope","$scope","$modal",function(a,b,c){b.$on("showNotificationDialogEvent",function(a,b){c.open({templateUrl:"app/notification/notification-modal.tpl.html",controller:"NotificationModalController",resolve:{notification:function(){return b}}})}),b.$on("showConfirmDialogEvent",function(b,d,e){c.open({templateUrl:"app/notification/notification-confirm-modal.tpl.html",controller:"NotificationConfirmationController",resolve:{confirm:function(){return d}}}).result.then(function(){a.$broadcast("confirmDialogAcceptedEvent",e)},function(){a.$broadcast("confirmDialogRejectedEvent",e)})})}]).controller("NotificationModalController",["$scope","$modalInstance","notification",function(a,b,c){a.notification=c,a.close=function(){b.dismiss("close")}}]).controller("NotificationConfirmationController",["$scope","$modalInstance","confirm",function(a,b,c){a.confirm=c,a.ok=function(){b.close()},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("obiba.notification",["pascalprecht.translate","ui.bootstrap"]),angular.module("obiba.rest",["obiba.notification"]).config(["$httpProvider",function(a){a.responseInterceptors.push("loadingHttpInterceptor"),a.responseInterceptors.push("httpErrorsInterceptor"),a.defaults.transformRequest.push(function(a){return $("#loading").show(),a})}]).factory("loadingHttpInterceptor",["$q",function(a){return function(b){return b.then(function(a){return $("#loading").hide(),a},function(b){return $("#loading").hide(),a.reject(b)})}}]).factory("httpErrorsInterceptor",["$q","$rootScope","$log",function(a,b){return function(c){return c.then(function(a){return a},function(c){var d=c.config;return d.errorHandler?a.reject(c):(b.$broadcast("showNotificationDialogEvent",{iconClass:"fa-exclamation-triangle",titleKey:"error",message:c.data?c.data:angular.fromJson(c)}),a.reject(c))})}}]),angular.module("obiba.utils",[]).service("StringUtils",function(){this.capitaliseFirstLetter=function(a){return a.charAt(0).toUpperCase()+a.slice(1)}}),angular.module("templates-main",["form/form-checkbox-template.tpl.html","form/form-input-template.tpl.html","notification/notification-confirm-modal.tpl.html","notification/notification-modal.tpl.html"]),angular.module("form/form-checkbox-template.tpl.html",[]).run(["$templateCache",function(a){a.put("form/form-checkbox-template.tpl.html",'<div class="checkbox" ng-class="{\'has-error\': (form[fieldName].$dirty || form.saveAttempted) && form[name].$invalid}">\n\n  <label for="{{name}}" class="control-label">\n    {{label | translate}}\n    <span ng-show="required">*</span>\n  </label>\n\n  <input\n      ng-model="model"\n      type="checkbox"\n      id="{{name}}"\n      name="{{name}}"\n      server-error>\n\n  <ul class="input-error list-unstyled" ng-show="form[name].$dirty && form[name].$invalid">\n    <li ng-show="form[name].$error.required" translate>required</li>\n    <li ng-repeat="error in form[name].errors">{{error}}</li>\n  </ul>\n\n  <p ng-show="help" class="help-block">{{help | translate}}</p>\n\n</div>\n\n')}]),angular.module("form/form-input-template.tpl.html",[]).run(["$templateCache",function(a){a.put("form/form-input-template.tpl.html",'<div class="form-group" ng-class="{\'has-error\': (form[name].$dirty || form.saveAttempted) && form[name].$invalid}">\n\n  <label for="{{name}}" class="control-label">\n    {{label | translate}}\n    <span ng-show="required">*</span>\n  </label>\n\n  <input\n      ng-model="model"\n      type="text"\n      class="form-control"\n      id="{{name}}"\n      name="{{name}}"\n      server-error\n      ng-required="required">\n\n  <ul class="input-error list-unstyled" ng-show="form[name].$dirty && form[name].$invalid">\n    <li ng-show="form[name].$error.required" translate>required</li>\n    <li ng-repeat="error in form[name].errors">{{error}}</li>\n  </ul>\n\n  <p ng-show="help" class="help-block">{{help | translate}}</p>\n\n</div>')}]),angular.module("notification/notification-confirm-modal.tpl.html",[]).run(["$templateCache",function(a){a.put("notification/notification-confirm-modal.tpl.html",'<div class="modal-content">\n\n  <div class="modal-header">\n    <button type="button" class="close" aria-hidden="true" ng-click="cancel()">&times;</button>\n    <h4 class="modal-title">\n      <i class="fa fa-exclamation-triangle"></i>\n      <span ng-hide="confirm.title" translate>confirmation</span>\n      {{confirm.title}}\n    </h4>\n  </div>\n\n  <div class="modal-body">\n    <p>{{confirm.message}}</p>\n  </div>\n\n  <div class="modal-footer">\n    <button type="button" class="btn btn-default" ng-click="cancel()">\n      <span ng-hide="confirm.cancel" translate>cancel</span>\n      {{confirm.cancel}}\n    </button>\n    <button type="button" class="btn btn-primary" ng-click="ok()">\n      <span ng-hide="confirm.ok" translate>ok</span>\n      {{confirm.ok}}\n    </button>\n  </div>\n\n</div>')}]),angular.module("notification/notification-modal.tpl.html",[]).run(["$templateCache",function(a){a.put("notification/notification-modal.tpl.html",'<div class="modal-content">\n\n  <div class="modal-header">\n    <button type="button" class="close" aria-hidden="true" ng-click="close()">&times;</button>\n    <h4 class="modal-title">\n      <i ng-hide="notification.iconClass" class="fa fa-info-circle"></i>\n      <i ng-show="notification.iconClass" class="fa {{notification.iconClass}}"></i>\n      <span ng-hide="notification.title" translate>{{notification.titleKey || \'notification\'}}</span>\n      {{notification.title}}\n    </h4>\n  </div>\n\n  <div class="modal-body">\n    <p>{{notification.message}}</p>\n  </div>\n\n  <div class="modal-footer">\n    <button type="button" class="btn btn-default" ng-click="close()">\n      <span translate>close</span>\n    </button>\n  </div>\n\n</div>')}]);